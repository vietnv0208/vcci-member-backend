# üè¢ Members Module - VCCI Member Management

Module qu·∫£n l√Ω h·ªôi vi√™n VCCI v·ªõi ƒë·∫ßy ƒë·ªß t√≠nh nƒÉng CRUD, x√©t duy·ªát v√† qu·∫£n l√Ω tr·∫°ng th√°i.

## üìã T√≠nh nƒÉng

### ‚úÖ ƒê√£ ho√†n th√†nh

- ‚úÖ **CRUD Operations**: T·∫°o, ƒë·ªçc, c·∫≠p nh·∫≠t, x√≥a h·ªôi vi√™n
- ‚úÖ **Public Member Registration**: API c√¥ng khai cho ƒëƒÉng k√Ω h·ªôi vi√™n (kh√¥ng c·∫ßn authentication)
- ‚úÖ **Member Registration**: ƒêƒÉng k√Ω h·ªôi vi√™n m·ªõi (Doanh nghi·ªáp & Hi·ªáp h·ªôi)
- ‚úÖ **Status Management**: Qu·∫£n l√Ω tr·∫°ng th√°i h·ªôi vi√™n v·ªõi workflow
- ‚úÖ **Search & Filter**: T√¨m ki·∫øm v√† l·ªçc h·ªôi vi√™n theo nhi·ªÅu ti√™u ch√≠
- ‚úÖ **Pagination**: Ph√¢n trang danh s√°ch h·ªôi vi√™n
- ‚úÖ **Statistics**: Th·ªëng k√™ t·ªïng quan v·ªÅ h·ªôi vi√™n
- ‚úÖ **Member Code Generation**: T·ª± ƒë·ªông sinh m√£ h·ªôi vi√™n (VCCI{YEAR}{NUMBER})
- ‚úÖ **Status History**: L∆∞u l·ªãch s·ª≠ thay ƒë·ªïi tr·∫°ng th√°i
- ‚úÖ **Business Categories Management**: Qu·∫£n l√Ω ng√†nh ngh·ªÅ kinh doanh v·ªõi c·∫•u tr√∫c ph√¢n c·∫•p
- ‚úÖ **Business Categories in Response**: Tr·∫£ v·ªÅ th√¥ng tin ƒë·∫ßy ƒë·ªß c·ªßa business categories trong member response
- ‚úÖ **Hierarchical Category Search**: T√¨m ki·∫øm theo category cha s·∫Ω t·ª± ƒë·ªông bao g·ªìm t·∫•t c·∫£ category con
- ‚úÖ **Contact Management**: Qu·∫£n l√Ω ng∆∞·ªùi li√™n h·ªá/l√£nh ƒë·∫°o
- ‚úÖ **Role-based Access Control**: Ph√¢n quy·ªÅn theo vai tr√≤

## üèóÔ∏è Ki·∫øn tr√∫c

```
src/features/members/
‚îú‚îÄ‚îÄ dto/                                  # Data Transfer Objects
‚îÇ   ‚îú‚îÄ‚îÄ create-member.dto.ts             # DTO t·∫°o h·ªôi vi√™n m·ªõi
‚îÇ   ‚îú‚îÄ‚îÄ update-member.dto.ts             # DTO c·∫≠p nh·∫≠t h·ªôi vi√™n
‚îÇ   ‚îú‚îÄ‚îÄ query-member.dto.ts              # DTO query/filter
‚îÇ   ‚îú‚îÄ‚îÄ member-response.dto.ts           # DTO response
‚îÇ   ‚îú‚îÄ‚îÄ change-member-status.dto.ts      # DTO thay ƒë·ªïi tr·∫°ng th√°i
‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îú‚îÄ‚îÄ members.controller.ts                 # REST API endpoints (Protected)
‚îú‚îÄ‚îÄ members-public.controller.ts          # Public API endpoints (No Auth)
‚îú‚îÄ‚îÄ members.service.ts                    # Business logic
‚îú‚îÄ‚îÄ members.repository.ts                 # Data access layer
‚îú‚îÄ‚îÄ members.module.ts                     # NestJS module
‚îú‚îÄ‚îÄ index.ts                              # Exports
‚îî‚îÄ‚îÄ README.md                             # Documentation
```

## üîå API Endpoints

### üåê Public API (Kh√¥ng c·∫ßn Authentication)

#### 1. ƒêƒÉng k√Ω h·ªôi vi√™n (Public)
```http
POST /api/public/members/register
Content-Type: application/json
```

**M√¥ t·∫£:** API c√¥ng khai cho ph√©p doanh nghi·ªáp/hi·ªáp h·ªôi t·ª± ƒëƒÉng k√Ω l√†m h·ªôi vi√™n VCCI m√† kh√¥ng c·∫ßn ƒëƒÉng nh·∫≠p. ƒê∆°n ƒëƒÉng k√Ω s·∫Ω t·ª± ƒë·ªông c√≥ tr·∫°ng th√°i `PENDING` v√† ch·ªù admin x√©t duy·ªát.

**Request Body:** (Gi·ªëng nh∆∞ endpoint t·∫°o member b√™n d∆∞·ªõi)

**Response:**
```json
{
  "id": "cm...",
  "code": "VCCI20250001",
  "status": "PENDING",
  "vietnameseName": "C√¥ng ty TNHH ABC",
  "email": "contact@abc.com",
  "telephone": "024-1234567",
  "officeAddress": "123 ƒê∆∞·ªùng ABC",
  "enterpriseDetail": { ... },
  "contacts": [ ... ],
  "businessCategories": [
    {
      "id": "cat_001",
      "code": "A",
      "name": "N√¥ng nghi·ªáp, l√¢m nghi·ªáp v√† thu·ª∑ s·∫£n",
      "level": 1,
      "parentId": null,
      "isActive": true
    },
    {
      "id": "cat_002",
      "code": "01",
      "name": "Tr·ªìng tr·ªçt v√† chƒÉn nu√¥i",
      "level": 2,
      "parentId": "cat_001",
      "isActive": true
    }
  ],
  "createdAt": "2025-01-15T...",
  "updatedAt": "2025-01-15T..."
}
```

---

### üîí Protected API (Y√™u c·∫ßu Authentication)

#### 1. T·∫°o ƒë∆°n ƒëƒÉng k√Ω h·ªôi vi√™n m·ªõi (Admin)
```http
POST /api/members
Authorization: Bearer {token}
Roles: SUPER_ADMIN, ADMIN, MANAGEMENT
```

**Request Body:**
```json
{
  "applicationType": "ENTERPRISE",
  "memberType": "LINKED",
  "vietnameseName": "C√¥ng ty TNHH ABC",
  "englishName": "ABC Company Limited",
  "abbreviation": "ABC Co.",
  "officeAddress": "123 ƒê∆∞·ªùng ABC, H√† N·ªôi",
  "businessAddress": "456 ƒê∆∞·ªùng XYZ, H√† N·ªôi",
  "telephone": "024-1234567",
  "email": "contact@abc.com",
  "website": "https://abc.com",
  "taxCode": "0123456789",
  "expireDate": "2025-12-31",
  "remarks": "Ghi ch√∫",
  "enterpriseDetail": {
    "businessRegistrationNo": "0123456789",
    "businessRegistrationDate": "2020-01-01",
    "issuedBy": "S·ªü KH&ƒêT H√† N·ªôi",
    "registeredCapital": 10000000000,
    "totalAsset": 50000000000,
    "previousYearRevenue": 100000000000,
    "totalEmployees": 100,
    "branchInfo": "Chi nh√°nh t·∫°i TP.HCM",
    "organizationTypes": ["ORG_TYPE_001"]
  },
  "contacts": [
    {
      "contactRole": "CEO",
      "fullName": "Nguy·ªÖn VƒÉn A",
      "gender": "MALE",
      "telephone": "024-1234567",
      "mobile": "0901234567",
      "email": "ceo@abc.com",
      "note": "Gi√°m ƒë·ªëc ƒëi·ªÅu h√†nh"
    }
  ],
  "businessCategoryIds": ["cat_001", "cat_002"],
  "attachmentIds": ["file_001", "file_002"]
}
```

#### 2. L·∫•y danh s√°ch h·ªôi vi√™n
```http
GET /api/members?search=ABC&status=PENDING&page=1&limit=10
Authorization: Bearer {token}
Roles: SUPER_ADMIN, ADMIN, MANAGEMENT
```

**Query Parameters:**
- `search`: T√¨m ki·∫øm theo t√™n, email, m√£ s·ªë thu·∫ø
- `applicationType`: ENTERPRISE | ASSOCIATION
- `memberType`: LINKED | OFFICIAL | HONORARY
- `status`: PENDING | APPROVED | REJECTED | CANCELLED | ACTIVE | INACTIVE | SUSPENDED | TERMINATED
- `businessCategoryId`: **L·ªçc theo ng√†nh ngh·ªÅ kinh doanh** (s·∫Ω t√¨m c·∫£ category con) - VD: n·∫øu ch·ªçn "N√¥ng nghi·ªáp" (level 1) s·∫Ω t√¨m t·∫•t c·∫£ members c√≥ ng√†nh ngh·ªÅ thu·ªôc "N√¥ng nghi·ªáp" v√† c√°c ng√†nh con nh∆∞ "Tr·ªìng tr·ªçt", "ChƒÉn nu√¥i"...
- `submittedDateFrom`: Ng√†y ƒëƒÉng k√Ω t·ª´ (ISO 8601)
- `submittedDateTo`: Ng√†y ƒëƒÉng k√Ω ƒë·∫øn (ISO 8601)
- `approvedDateFrom`: Ng√†y duy·ªát t·ª´ (ISO 8601)
- `approvedDateTo`: Ng√†y duy·ªát ƒë·∫øn (ISO 8601)
- `page`: S·ªë trang (default: 1)
- `limit`: S·ªë l∆∞·ª£ng m·ªói trang (default: 10, max: 100)
- `sortBy`: S·∫Øp x·∫øp theo tr∆∞·ªùng (default: createdAt)
- `sortOrder`: asc | desc (default: desc)

#### 3. L·∫•y th·ªëng k√™ h·ªôi vi√™n
```http
GET /api/members/statistics
Authorization: Bearer {token}
Roles: SUPER_ADMIN, ADMIN, MANAGEMENT
```

#### 4. L·∫•y th√¥ng tin chi ti·∫øt h·ªôi vi√™n
```http
GET /api/members/:id
Authorization: Bearer {token}
Roles: SUPER_ADMIN, ADMIN, MANAGEMENT
```

#### 5. L·∫•y th√¥ng tin h·ªôi vi√™n theo m√£
```http
GET /api/members/code/:code
Authorization: Bearer {token}
Roles: SUPER_ADMIN, ADMIN, MANAGEMENT
```

#### 6. C·∫≠p nh·∫≠t th√¥ng tin h·ªôi vi√™n
```http
PATCH /api/members/:id
Authorization: Bearer {token}
Roles: SUPER_ADMIN, ADMIN, MANAGEMENT
```

#### 7. Thay ƒë·ªïi tr·∫°ng th√°i h·ªôi vi√™n
```http
PATCH /api/members/:id/status
Authorization: Bearer {token}
Roles: SUPER_ADMIN, ADMIN
```

**Request Body:**
```json
{
  "status": "APPROVED",
  "remark": "ƒê√£ x√©t duy·ªát v√† ch·∫•p nh·∫≠n"
}
```

#### 8. X√≥a h·ªôi vi√™n
```http
DELETE /api/members/:id
Authorization: Bearer {token}
Roles: SUPER_ADMIN
```

## üîÑ Member Status Workflow

```
PENDING (Ch·ªù x√©t duy·ªát)
  ‚îú‚îÄ> APPROVED (ƒê∆∞·ª£c duy·ªát)
  ‚îÇ     ‚îú‚îÄ> ACTIVE (ƒêang ho·∫°t ƒë·ªông)
  ‚îÇ     ‚îÇ     ‚îú‚îÄ> INACTIVE (Kh√¥ng ho·∫°t ƒë·ªông)
  ‚îÇ     ‚îÇ     ‚îÇ     ‚îú‚îÄ> ACTIVE
  ‚îÇ     ‚îÇ     ‚îÇ     ‚îî‚îÄ> TERMINATED (Ch·∫•m d·ª©t)
  ‚îÇ     ‚îÇ     ‚îî‚îÄ> SUSPENDED (T·∫°m ng∆∞ng)
  ‚îÇ     ‚îÇ           ‚îú‚îÄ> ACTIVE
  ‚îÇ     ‚îÇ           ‚îî‚îÄ> TERMINATED
  ‚îÇ     ‚îî‚îÄ> REJECTED (B·ªã t·ª´ ch·ªëi)
  ‚îÇ           ‚îî‚îÄ> PENDING
  ‚îú‚îÄ> REJECTED
  ‚îÇ     ‚îî‚îÄ> PENDING
  ‚îî‚îÄ> CANCELLED (ƒê√£ h·ªßy)
        ‚îî‚îÄ> PENDING
```

### Quy t·∫Øc chuy·ªÉn tr·∫°ng th√°i:

- **PENDING** ‚Üí APPROVED, REJECTED, CANCELLED
- **APPROVED** ‚Üí ACTIVE, REJECTED
- **REJECTED** ‚Üí PENDING
- **CANCELLED** ‚Üí PENDING
- **ACTIVE** ‚Üí INACTIVE, SUSPENDED
- **INACTIVE** ‚Üí ACTIVE, TERMINATED
- **SUSPENDED** ‚Üí ACTIVE, TERMINATED
- **TERMINATED** ‚Üí (Kh√¥ng th·ªÉ chuy·ªÉn)

## üìä Database Schema

### Member
- Th√¥ng tin c∆° b·∫£n: t√™n, ƒë·ªãa ch·ªâ, li√™n h·ªá
- M√£ h·ªôi vi√™n t·ª± ƒë·ªông: `VCCI{YEAR}{NUMBER}` (VD: VCCI20250001)
- Lo·∫°i ƒë∆°n: ENTERPRISE, ASSOCIATION
- Lo·∫°i h·ªôi vi√™n: LINKED, OFFICIAL, HONORARY
- Tr·∫°ng th√°i: PENDING, APPROVED, REJECTED, CANCELLED, ACTIVE, INACTIVE, SUSPENDED, TERMINATED

### MemberEnterpriseDetail
- Th√¥ng tin doanh nghi·ªáp
- Gi·∫•y ph√©p kinh doanh
- V·ªën ƒëi·ªÅu l·ªá, t√†i s·∫£n, doanh thu
- S·ªë l∆∞·ª£ng nh√¢n vi√™n
- Lo·∫°i h√¨nh t·ªï ch·ª©c

### MemberAssociationDetail
- Th√¥ng tin hi·ªáp h·ªôi
- Gi·∫•y ph√©p th√†nh l·∫≠p
- S·ªë l∆∞·ª£ng h·ªôi vi√™n

### MemberContact
- Ng∆∞·ªùi li√™n h·ªá/l√£nh ƒë·∫°o
- Vai tr√≤: CHAIR_PERSON, CEO, CHIEF_OFFICE, SECRETARY_GENERAL, CONTACT_1, CONTACT_2
- Th√¥ng tin li√™n l·∫°c

### MemberStatusHistory
- L·ªãch s·ª≠ thay ƒë·ªïi tr·∫°ng th√°i
- Ng∆∞·ªùi th·ª±c hi·ªán
- Ghi ch√∫

### MemberEnterpriseBusinessCategory
- Li√™n k·∫øt v·ªõi danh m·ª•c ng√†nh ngh·ªÅ

### BusinessCategory (Returned in Response)
M·ªói member s·∫Ω tr·∫£ v·ªÅ danh s√°ch `businessCategories` v·ªõi th√¥ng tin ƒë·∫ßy ƒë·ªß:
```json
{
  "id": "category_id",
  "code": "A",                    // M√£ danh m·ª•c theo Qƒê 27/2018/Qƒê-TTg
  "name": "N√¥ng nghi·ªáp, l√¢m nghi·ªáp v√† thu·ª∑ s·∫£n",
  "level": 1,                     // C·∫•p ƒë·ªô: 1 (Section), 2 (Division), 3 (Group), 4 (Class)
  "parentId": null,               // ID danh m·ª•c cha (null n·∫øu l√† root)
  "isActive": true                // Tr·∫°ng th√°i ho·∫°t ƒë·ªông
}
```

**C·∫•u tr√∫c ph√¢n c·∫•p:**
- **Level 1 (Section)**: A, B, C... (21 sections) - VD: "A - N√¥ng nghi·ªáp, l√¢m nghi·ªáp v√† thu·ª∑ s·∫£n"
- **Level 2 (Division)**: 01, 02, 03... (88 divisions) - VD: "01 - Tr·ªìng tr·ªçt v√† chƒÉn nu√¥i"
- **Level 3 (Group)**: 011, 012, 013... - VD: "011 - Tr·ªìng c√¢y h√†ng nƒÉm"
- **Level 4 (Class)**: 0111, 0112... - VD: "0111 - Tr·ªìng l√∫a"

## üîê Ph√¢n quy·ªÅn

| Endpoint | SUPER_ADMIN | ADMIN | MANAGEMENT | MEMBER |
|----------|-------------|-------|------------|--------|
| POST /members | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå |
| GET /members | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå |
| GET /members/:id | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå |
| GET /members/code/:code | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå |
| GET /members/statistics | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå |
| PATCH /members/:id | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå |
| PATCH /members/:id/status | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| DELETE /members/:id | ‚úÖ | ‚ùå | ‚ùå | ‚ùå |

## üß™ Testing

```bash
# Unit tests
npm run test -- members

# E2E tests
npm run test:e2e -- members

# Coverage
npm run test:cov
```

## üìù Usage Examples

### T·∫°o h·ªôi vi√™n doanh nghi·ªáp
```typescript
const member = await membersService.create({
  applicationType: 'ENTERPRISE',
  vietnameseName: 'C√¥ng ty ABC',
  email: 'contact@abc.com',
  telephone: '024-1234567',
  officeAddress: '123 ƒê∆∞·ªùng ABC',
  enterpriseDetail: {
    businessRegistrationNo: '0123456789',
    organizationTypes: ['ORG_TYPE_001']
  },
  contacts: [
    {
      contactRole: 'CEO',
      fullName: 'Nguy·ªÖn VƒÉn A',
      email: 'ceo@abc.com'
    }
  ]
}, userId);
```

### T√¨m ki·∫øm h·ªôi vi√™n
```typescript
const result = await membersService.findAll({
  search: 'ABC',
  status: 'ACTIVE',
  applicationType: 'ENTERPRISE',
  page: 1,
  limit: 10
});
```

### T√¨m ki·∫øm theo ng√†nh ngh·ªÅ kinh doanh (v·ªõi category con)
```typescript
// T√¨m t·∫•t c·∫£ members c√≥ ng√†nh ngh·ªÅ l√† "N√¥ng nghi·ªáp" 
// ho·∫∑c c√°c ng√†nh con (Tr·ªìng tr·ªçt, ChƒÉn nu√¥i, L√¢m nghi·ªáp...)
const result = await membersService.findAll({
  businessCategoryId: 'agriculture_category_id', // ID c·ªßa category "N√¥ng nghi·ªáp"
  page: 1,
  limit: 20
});

// K·∫øt qu·∫£ s·∫Ω bao g·ªìm:
// - Members c√≥ category ch√≠nh x√°c l√† "N√¥ng nghi·ªáp"
// - Members c√≥ category l√† "Tr·ªìng tr·ªçt" (con c·ªßa N√¥ng nghi·ªáp)
// - Members c√≥ category l√† "Tr·ªìng l√∫a" (con c·ªßa Tr·ªìng tr·ªçt)
// - ... t·∫•t c·∫£ descendants
```

### Thay ƒë·ªïi tr·∫°ng th√°i
```typescript
const member = await membersService.changeStatus(
  memberId,
  {
    status: 'APPROVED',
    remark: 'ƒê√£ x√©t duy·ªát'
  },
  userId
);
```

## üöÄ Next Steps

- [ ] Implement file attachment management
- [ ] Add email notifications for status changes
- [ ] Add member renewal workflow
- [ ] Add member fee management
- [ ] Add export to Excel/PDF
- [ ] Add bulk import from Excel
- [ ] Add member portal for self-service
- [ ] Add advanced reporting

## üìö Related Modules

- **Auth Module**: Authentication & Authorization
- **Users Module**: User management
- **Files Module**: File upload/download
- **Categories Module**: Organization types, business categories

---

*Module n√†y ƒë∆∞·ª£c ph√°t tri·ªÉn theo feature-based architecture c·ªßa VCCI Member Backend.*
